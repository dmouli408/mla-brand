<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Multi JSON to Excel Table</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 100%; height: 200px; font-family: monospace; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; table-layout: fixed; }
    th, td { border: 1px solid #ccc; padding: 5px; font-size: 13px; }
    input { width: 100%; border: none; }
    button { padding: 10px 20px; background: green; color: white; border: none; margin-top: 10px; }
    button:hover { background: darkgreen; }
  </style>
</head>
<body>

<h2>📥 Paste Multiple JSON Blocks Below</h2>
<textarea id="jsonInput" placeholder="Paste multiple JSONs here..."></textarea>
<br>
<button onclick="parseAndRender()">Convert to Table</button>
<button onclick="downloadExcel()">Download Excel</button>

<div id="tableContainer"></div>

<script>
  let headers = [];

  function parseAndRender() {
    const container = document.getElementById("tableContainer");
    container.innerHTML = "";
    const inputText = document.getElementById("jsonInput").value;

    // Split into individual JSON blocks
    const rawBlocks = inputText.trim().split(/(?=\{[\s\S]*?"DataList"\s*:\s*\[)/);
    let combinedData = [];

    try {
      for (let block of rawBlocks) {
        block = block.trim();
        if (block.endsWith(",")) block = block.slice(0, -1); // Remove trailing comma
        if (block) {
          const parsed = JSON.parse(block);
          if (parsed.DataList && Array.isArray(parsed.DataList)) {
            combinedData = combinedData.concat(parsed.DataList);
          }
        }
      }
    } catch (e) {
      alert("⚠️ Invalid JSON format. Please check for syntax issues.");
      return;
    }

    if (combinedData.length === 0) {
      alert("No valid DataList found.");
      return;
    }

    // Build table
    headers = Object.keys(combinedData[0]);
    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const trHead = document.createElement("tr");
    headers.forEach(h => {
      const th = document.createElement("th");
      th.textContent = h;
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");
    combinedData.forEach((row, rowIndex) => {
      const tr = document.createElement("tr");
      headers.forEach(h => {
        const td = document.createElement("td");
        const input = document.createElement("input");
        input.value = row[h] !== null && row[h] !== undefined ? row[h] : '';
        td.appendChild(input);
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    container.appendChild(table);
  }

  function downloadExcel() {
    const rows = document.querySelectorAll("table tbody tr");
    const data = [];

    rows.forEach(row => {
      const rowData = {};
      row.querySelectorAll("input").forEach((input, index) => {
        rowData[headers[index]] = input.value;
      });
      data.push(rowData);
    });

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "DataList");
    XLSX.writeFile(wb, "combined_data.xlsx");
  }
</script>

</body>
</html>
